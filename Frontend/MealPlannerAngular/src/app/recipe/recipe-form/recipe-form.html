<form #form="ngForm" (ngSubmit)="save(form)" novalidate class="recipe-form-container">

  <!-- Name -->
  <label for="name">Name</label>
  <input 
    id="name" 
    name="name" 
    [(ngModel)]="recipe.name" 
    required 
    minlength="3" 
    #nameCtrl="ngModel" 
  />
  <div *ngIf="nameCtrl.touched && nameCtrl.invalid" class="error-box">
    <div *ngIf="nameCtrl.errors?.['required']">Name is required</div>
    <div *ngIf="nameCtrl.errors?.['minlength']">Name must be at least 3 characters</div>
    <div *ngIf="nameTaken">This name is already in use</div>
  </div>

  <!-- Cooking Time -->
  <label for="cookingTime">Cooking Time (min)</label>
  <input 
    id="cookingTime" 
    name="cookingTime" 
    type="number" 
    [(ngModel)]="recipe.cookingTime" 
  />

  <!-- Instructions -->
  <label for="instructions">Instructions</label>
  <textarea 
    id="instructions" 
    name="instructions"
    [(ngModel)]="recipe.instructions">
  </textarea>

  <!-- Ingredients -->
  <div class="ingredients-section">
    <label>Ingredients</label>

    <div *ngFor="let ing of recipe.ingredients; let i = index" class="ingredient-row">
      <input
        name="ingredientName{{i}}"
        [(ngModel)]="recipe.ingredients[i].name"
        required
        placeholder="Ingredient"
        #ingName="ngModel"
      />

      <input
        name="ingredientQty{{i}}"
        [(ngModel)]="recipe.ingredients[i].quantity"
        placeholder="Quantity"
      />

      <button type="button" (click)="removeIngredient(i)">Remove</button>

      <!-- Per-item error message (must be inside the ngFor so ingName exists) -->
      <div class="error-box" *ngIf="ingName.touched && ingName.invalid">
        <small>Ingredient name is required</small>
      </div>
    </div>

    <button type="button" class="add-btn" (click)="addIngredient()">Add Ingredient</button>
  </div>

  <!-- Save / Cancel -->
  <div class="actions">
    <button type="submit" [disabled]="saving">Save</button>
    <button type="button" (click)="cancel()">Cancel</button>
  </div>

  <div *ngIf="error" class="error-box">{{ error }}</div>
</form>